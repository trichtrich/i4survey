<?xml version="1.0" ?>
<odoo>
    <template id="i4s_result" name="Phiếu khảo sát">
        <t t-call="website.layout">
            <div class="container-fluid">
                <div id="survey-wizard" class="wizard-root">
                    <ul>
                        <li><a href="#tab1" data-toggle="tab" data-group-title="Biểu đồ tổng hợp">Biểu đồ tổng hợp</a></li>

                        <t t-foreach="results" t-as="r">
                            <li>
                                <a t-att-href="'#tab' + str(r_index + 2)" data-toggle="tab" data-group-title="Chiến lược">
                                    <t t-esc="r['name']"/>
                                </a>
                            </li>
                        </t>
                    </ul>

                    <h4 class="wizard-group-title pull-left"></h4>
                    <ul class="pager wizard pull-right">
                        <li class="previous"><a href="javascript:;">Trước</a></li>
                        <li class="next"><a href="javascript:;">Sau</a></li>
                    </ul>
                    <div class="clearfix"></div>
                    <hr class="wizard-group-title-border"/>
                    
                    <div class="tab-content">
                        <div class="tab-pane" id="tab1">
                            <div class="row">
                                Biểu đồ tổng hợp
                            </div>
                        </div>
                        <t t-foreach="results" t-as="r">
                            <div class="tab-pane" t-att-id="'tab' + str(r_index + 2)">
                                <input type="hidden" t-att-value="'tab' + str(r_index + 2)" t-att-id="'iTab'+ str(r_index + 2)"/>
                                <input type="hidden" t-att-value="r['name']" t-att-id="'nameChart'+ str(r_index + 2)"/>
                                <div class="row">
                                    <div class="col-md-7 mb-20">
                                        <t t-foreach="r['groups']" t-as="g">
                                            <div class="row group">
                                                <div class="col-md-10 mb-20">
                                                    <div class="group-title">
                                                        <t t-esc="g['display']"/>
                                                    </div>

                                                    <div class="group-description">
                                                        <t t-esc="g['total']"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                    <input type="hidden" t-att-value="'container-chart' + str(r['idstr'])" t-att-id="'idChart'+ str(r_index + 2)"/>
                                    <div t-att-id="'container-chart' + str(r['idstr'])" style="min-width: 400px; max-width: 600px; height: 400px; margin: 0 auto"></div>
                                </div>
                            </div>
                            <script>
                                $(document).ready(function () {
                                    var iTab = $('#iTab<t t-esc="str(r_index + 2)"/>').val();
                                    console.log(iTab+"---itab-lttai---");
                                    var nameChart = $('#nameChart<t t-esc="str(r_index + 2)"/>').val();
                                    var idChart = $('#idChart<t t-esc="str(r_index + 2)"/>').val();
                                    var total = [];
                                    var gname = [];
                                    var idQuery = '#'+iTab + ' .group-description';
                                    var idTitle = '#'+iTab + ' .group-title';
                                    $(idQuery).each(function(){
                                        //total += "" + this.innerText.trim() + ", ";
                                        //console.log(total+"-total-lttai-");
                                        total.push(parseFloat(this.innerText.trim()));
                                    });
                                    //total += ']';

                                    $(idTitle).each(function(){
                                        //gname += "'" + this.innerText.trim() + "',";
                                        gname.push(this.innerText.trim());
                                    });
                                    console.log("--total--"+total+"===");
                                    console.log("--gname--"+gname+"===");
                                    var data = {"name": nameChart, "data": total};
                                    console.log(data);

                                    var options = {

                                        chart: {
                                            renderTo: '',
                                            polar: true,
                                            type: 'line'
                                        },
                                        credits : {
                                            enable:false
                                        },
                                        title: {
                                            text: nameChart,
                                            x: -80
                                        },

                                        pane: {
                                            size: '80%'
                                        },

                                        xAxis: {
                                            categories: gname,
                                            tickmarkPlacement: 'on',
                                            lineWidth: 0
                                        },

                                        yAxis: {
                                            gridLineInterpolation: 'polygon',
                                            lineWidth: 0,
                                            min: 0
                                        },

                                        tooltip: {
                                            shared: true,
                                            pointFormat: '{point.y:,.1f}'
                                        },

                                        legend: {
                                            align: 'right',
                                            verticalAlign: 'top',
                                            y: 70,
                                            layout: 'vertical'
                                        },

                                        series: []
                                    };

                                    options.chart.renderTo = idChart;
                                    
                                    options.series[0] = data;

                                    var iChart = new Highcharts.Chart(options);
                                });
                            </script>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>